# 集群升级



## 背景

集群版本升级，v1.10->v1.17



## 升级难点

升级过程中不能因为集群组件自身逻辑变化导致业务重启

- 当前运行版本较低，但是运行容器数量却很多，其中部分仍然是单副本运行，为了不影响业务运行，需要尽可能避免容器重启，这无疑是升级中最大的难点，而在 v1.10 版本和 v1.17 版本之间，kubelet 关于容器 Hash 值计算方式发生了变化，也就是说一旦升级必然会触发 kubelet 重新启动容器。

- 社区推荐的方式是基于偏差策略的升级以保证高可用集群升级同时不会因为 API resources 版本差异导致 kube-apiserve 和 kubelet 等组件出现兼容性错误，这就要求每次升级组件版本不能有 2 个 Final Release 以上的偏差，比如直接从 v1.11 升级至 v1.13 是不推荐的。

- 升级过程中由于新特性的引入，API 兼容性可能引发旧版本集群的配置不生效，为整个集群埋下稳定性隐患。要求在升级前尽可能的熟悉升级版本间的 ChangeLog，排查出可能带来潜在隐患的新特性。



## 升级方案



## References

https://mp.weixin.qq.com/s/fAp9bq7hhFDjn8MvP5mNgw